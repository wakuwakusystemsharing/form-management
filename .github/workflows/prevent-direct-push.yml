name: Prevent Direct Push

on:
  push:
    branches: [main, staging]

jobs:
  check-push-method:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check if push is from PR merge
        run: |
          # PRマージの場合はスキップ（GitHubが自動的にマージコミットを作成）
          if git log -1 --pretty=format:"%P" | grep -q " "; then
            echo "✅ This appears to be a merge commit (likely from PR)"
            exit 0
          fi
          
          # 直接プッシュの場合はエラー
          echo "❌ Error: 直接プッシュは許可されていません"
          echo ""
          echo "main (Production) への変更:"
          echo "  1. dev ブランチで開発"
          echo "  2. dev → staging へのPRを作成・マージ"
          echo "  3. staging → main へのPRを作成・マージ"
          echo ""
          echo "staging への変更:"
          echo "  1. dev または feature/* ブランチで開発"
          echo "  2. dev/feature/* → staging へのPRを作成・マージ"
          echo ""
          exit 1

