---
description: API and env — getAppEnvironment, normalizeForm, Japanese errors
globs: "src/app/api/**/*.ts,src/lib/env.ts"
alwaysApply: false
---

# API and environment rules

## Environment
- Use `getAppEnvironment()` from `@/lib/env` for branching (local / staging / production). Do not branch on raw `process.env.NEXT_PUBLIC_APP_ENV` in API.

## Form data
- After fetching a form (from JSON or Supabase), **always** call `normalizeForm(form)` before returning or using. Return the normalized result to the client.

## Errors
- API error responses must use **Japanese** messages for user-facing text: `{ error: '日本語のエラーメッセージ', details?: string }`. Do not replace existing Japanese messages with English.
