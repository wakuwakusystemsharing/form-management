# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“è¨­è¨ˆ

LINE LIFFã‚’æ´»ç”¨ã—ãŸäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“è¨­è¨ˆã€è¦ä»¶ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€æŠ€è¡“çš„æ±ºå®šã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LINE LIFF ãƒ¦ãƒ¼ã‚¶ãƒ¼                         â”‚
â”‚              (LINEå†…ã®äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ  - é™çš„HTML)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Vercel Blob   â”‚
         â”‚ Static Forms   â”‚
         â”‚ (HTML Deploy)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Deployment                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚               Next.js 15 (App Router)                         â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ Frontend (React/TypeScript)                                   â”‚â”‚
â”‚ â”‚ â”œâ”€ /admin - ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ãƒšãƒ¼ã‚¸                              â”‚â”‚
â”‚ â”‚ â”œâ”€ /[storeId]/admin - åº—èˆ—ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                 â”‚â”‚
â”‚ â”‚ â”œâ”€ /[storeId]/forms/[formId] - ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ç”»é¢              â”‚â”‚
â”‚ â”‚ â””â”€ /login - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢                                     â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ Backend (API Routes)                                          â”‚â”‚
â”‚ â”‚ â”œâ”€ /api/stores/* - åº—èˆ—ç®¡ç†API                               â”‚â”‚
â”‚ â”‚ â”œâ”€ /api/forms/* - ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†API                            â”‚â”‚
â”‚ â”‚ â”œâ”€ /api/forms/[formId]/deploy - é™çš„HTMLç”Ÿæˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤       â”‚â”‚
â”‚ â”‚ â”œâ”€ /api/reservations/* - äºˆç´„ç®¡ç†API                        â”‚â”‚
â”‚ â”‚ â””â”€ /api/upload/* - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰API                       â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ Middleware (èªè¨¼ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)                              â”‚â”‚
â”‚ â”‚ â”œâ”€ UI ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (/admin, /[storeId]/admin ãªã©)      â”‚â”‚
â”‚ â”‚ â”œâ”€ RLS ãƒã‚¤ãƒ‘ã‚¹åˆ¤å®š                                          â”‚â”‚
â”‚ â”‚ â””â”€ ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼                                       â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                 â”‚
         â”œâ”€ staging        â”œâ”€ production     â””â”€ local dev
         â”‚                 â”‚                    (JSON)
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Supabase  â”‚    â”‚ Supabase  â”‚
    â”‚ Staging   â”‚    â”‚ Productionâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

### 1. ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆReact/TypeScriptï¼‰

**è²¬å‹™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å‡¦ç†ã€API ã¨ã®é€šä¿¡

**ä¸»è¦ãƒšãƒ¼ã‚¸**:
- `/admin` - ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆåº—èˆ—ãƒ»ãƒ•ã‚©ãƒ¼ãƒ ãƒ»äºˆç´„ä¸€è¦§ï¼‰
- `/[storeId]/admin` - åº—èˆ—ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- `/[storeId]/forms/[formId]` - ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ç”»é¢ï¼ˆè¤‡æ•°ã‚¿ãƒ–å¯¾å¿œï¼‰
- `/login` - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆSupabase Authé€£æºï¼‰
- `/form/[formId]` - é¡§å®¢å‘ã‘ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆé™çš„HTMLæç”»ï¼‰

**ç‰¹å¾´**:
- Server Components + Client Components ã‚’é©åˆ‡ã«åˆ†é›¢
- çŠ¶æ…‹ç®¡ç†ã¯ React hooks ã®ã¿ï¼ˆZustand/Redux ä¸ä½¿ç”¨ï¼‰
- æ·±ãã‚³ãƒ”ãƒ¼ã—ã¦ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªæ›´æ–°
- èªè¨¼ã¯ middleware + ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§åˆ¶å¾¡

### 2. API å±¤ï¼ˆNext.js API Routesï¼‰

**è²¬å‹™**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST /api/stores - åº—èˆ—ä½œæˆ
GET  /api/stores - åº—èˆ—ä¸€è¦§
GET  /api/stores/[storeId] - åº—èˆ—è©³ç´°
PUT  /api/stores/[storeId] - åº—èˆ—æ›´æ–°
DELETE /api/stores/[storeId] - åº—èˆ—å‰Šé™¤

POST /api/stores/[storeId]/forms - ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
GET  /api/stores/[storeId]/forms - ãƒ•ã‚©ãƒ¼ãƒ ä¸€è¦§ï¼ˆåº—èˆ—åˆ¥ï¼‰
GET  /api/forms/[formId] - ãƒ•ã‚©ãƒ¼ãƒ è©³ç´°
PUT  /api/forms/[formId] - ãƒ•ã‚©ãƒ¼ãƒ æ›´æ–°
DELETE /api/forms/[formId] - ãƒ•ã‚©ãƒ¼ãƒ å‰Šé™¤
POST /api/forms/[formId]/deploy - é™çš„HTMLç”Ÿæˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

POST /api/reservations - äºˆç´„ä½œæˆ
GET  /api/reservations - å…¨äºˆç´„ä¸€è¦§ï¼ˆç®¡ç†è€…ç”¨ï¼‰
GET  /api/stores/[storeId]/reservations - åº—èˆ—åˆ¥äºˆç´„ä¸€è¦§

POST /api/upload/menu-image - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```

**èªè¨¼æ–¹é‡**:
- middleware ã§ã¯ UI ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿åˆ¶å¾¡
- API å†…ã§ç‹¬ç«‹ã—ãŸèªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆadmin client ä½¿ç”¨å¯èƒ½ï¼‰
- å…¨ API ã« `credentials: 'include'` ã§ Cookie é€ä¿¡

### 3. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤

#### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆJSON ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
data/
â”œâ”€â”€ stores.json - åº—èˆ—ä¸€è¦§
â”œâ”€â”€ forms.json - å…¨ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
â”œâ”€â”€ forms_st{storeId}.json - åº—èˆ—åˆ¥ãƒ•ã‚©ãƒ¼ãƒ 
â”œâ”€â”€ reservations.json - äºˆç´„ä¸€è¦§
â””â”€â”€ forms_st{storeId}.json - åº—èˆ—åˆ¥ãƒ•ã‚©ãƒ¼ãƒ 
```

#### Staging / Productionï¼ˆSupabaseï¼‰
```
Database Tables:
â”œâ”€â”€ stores - åº—èˆ—ãƒã‚¹ã‚¿
â”œâ”€â”€ forms - ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©ï¼ˆconfig ã¯ JSONBï¼‰
â”œâ”€â”€ reservations - äºˆç´„ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ store_admins - åº—èˆ—ç®¡ç†è€…ã®æ¨©é™ç®¡ç†
â””â”€â”€ profiles - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

RLS (Row Level Security):
â”œâ”€â”€ stores: å…¨å“¡èª­ã¿å–ã‚Šå¯ã€ç®¡ç†è€…ã®ã¿æ›´æ–°/å‰Šé™¤
â”œâ”€â”€ forms: åº—èˆ—åˆ¥RLSã€ç®¡ç†è€…ã¯å…¨åº—èˆ—ã‚¢ã‚¯ã‚»ã‚¹å¯
â”œâ”€â”€ reservations: åŒä¸Š
â””â”€â”€ store_admins: ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯
```

### 4. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤

#### Vercel Blobï¼ˆé¡§å®¢å‘ã‘ãƒ•ã‚©ãƒ¼ãƒ  HTMLï¼‰
```
Staging:  staging/forms/{storeId}/{formId}.html
Prod:     prod/forms/{storeId}/{formId}.html
Local:    /public/static-forms/{formId}.html (mock)
```

#### Vercel Blobï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒï¼‰
```
Staging:  staging/menu_images/{storeId}/{menuId}.{ext}
Prod:     prod/menu_images/{storeId}/{menuId}.{ext}
Local:    /public/uploads/{storeId}/{menuId}.{ext} (mock)
```

### 5. é™çš„HTMLç”Ÿæˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

**ãƒ•ãƒ­ãƒ¼**:
1. ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ãŒã€Œä¿å­˜ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. API `/api/forms/{formId}/deploy` ã‚’å‘¼ã³å‡ºã—
3. `StaticFormGenerator.generateHTML()` ã§ HTML ã‚’ç”Ÿæˆ
4. `VercelBlobDeployer.deployForm()` ã§ Blob ã« ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
5. `static_deploy` æƒ…å ±ã‚’ DB ã«è¨˜éŒ²
6. é¡§å®¢ãŒ LINE ã§ ãƒ•ã‚©ãƒ¼ãƒ  URL ã«ã‚¢ã‚¯ã‚»ã‚¹ â†’ é™çš„ HTML ã‚’è¡¨ç¤º

**æŠ€è¡“çš„ç‰¹å¾´**:
- HTML å†…ã« LIFF SDK + JavaScript ã‚’åŸ‹ã‚è¾¼ã¿
- React ä¸ä½¿ç”¨ï¼ˆè»½é‡åŒ–ã®ãŸã‚ vanilla JSï¼‰
- ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ CSS ã§é©ç”¨
- ã™ã¹ã¦ã®è¨­å®šï¼ˆmenu_structure ãªã©ï¼‰ã‚’ `FORM_CONFIG` ã¨ã—ã¦ JSON åŸ‹ã‚è¾¼ã¿

## ğŸ” èªè¨¼ãƒ»èªå¯è¨­è¨ˆ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å½¹å‰²

| å½¹å‰² | ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ©Ÿèƒ½ | èªè¨¼æ–¹æ³• |
|------|-------------------|---------|
| **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…** | å…¨åº—èˆ—ãƒ»å…¨ãƒ•ã‚©ãƒ¼ãƒ ãƒ»å…¨äºˆç´„ | Supabase Auth + admin email ç¢ºèª |
| **åº—èˆ—ç®¡ç†è€…** | è‡ªåº—èˆ—ã®ã¿ï¼ˆadmin email ã¯ä¸è¦ï¼‰ | Supabase Auth + RLS |
| **é¡§å®¢ï¼ˆLINE LIFFï¼‰** | è©²å½“ãƒ•ã‚©ãƒ¼ãƒ ã®ã¿ | ä¸è¦ï¼ˆå…¬é–‹URLï¼‰ |
| **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** | å…¨æ©Ÿèƒ½ï¼ˆèªè¨¼ã‚¹ã‚­ãƒƒãƒ—ï¼‰ | -ï¼ˆé–‹ç™ºç”¨ï¼‰ |

### èªè¨¼ãƒ•ãƒ­ãƒ¼

```
â‘  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ /admin ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
â‘¡ middleware ãŒèªè¨¼ãƒã‚§ãƒƒã‚¯
   - ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ: ã‚¹ã‚­ãƒƒãƒ—
   - æœ¬ç•ªç³»: Supabase ã‹ã‚‰ user å–å¾—
   â†“
â‘¢ user ãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ /login ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
â‘£ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â†’ accessToken ã‚’ Cookie ã«ä¿å­˜
   â†“
â‘¤ API å‘¼ã³å‡ºã—æ™‚ã« credentials: 'include' ã§ Cookie é€ä¿¡
â‘¥ API ãƒ«ãƒ¼ãƒˆå†…ã§ getUser() ã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
â‘¦ RLS ã§ åº—èˆ—åˆ¥ãƒ‡ãƒ¼ã‚¿ åˆ¶å¾¡
```

## ğŸ“ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Formï¼ˆãƒ•ã‚©ãƒ¼ãƒ å®šç¾©ï¼‰

```typescript
interface Form {
  id: string; // UUID ã¾ãŸã¯ st{timestamp}
  store_id: string; // UUID ã¾ãŸã¯ st{timestamp}
  config: FormConfig; // JSONB - è¤‡é›‘ãªæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
  draft_config?: FormConfig; // ä¸‹æ›¸ãç‰ˆconfig
  status: 'active' | 'inactive' | 'paused';
  draft_status: 'none' | 'draft' | 'ready_to_publish';
  form_name: string; // ãƒ•ã‚©ãƒ¼ãƒ åï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰
  line_settings?: { liff_id: string }; // LIFF ID
  gas_endpoint?: string; // Google Apps Script URL
  static_deploy?: StaticDeploy; // ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±
  created_at: string; // ISO å½¢å¼
  updated_at: string;
  last_published_at?: string;
}

interface FormConfig {
  basic_info: {
    form_name: string;
    store_name: string;
    liff_id: string;
    theme_color: string;
    logo_url?: string;
  };
  menu_structure: {
    structure_type: 'category_based' | 'simple';
    categories: MenuCategory[];
    display_options: DisplayOptions;
  };
  gender_selection: {
    enabled: boolean;
    required: boolean;
    options: SelectOption[];
  };
  visit_count_selection: { ... };
  coupon_selection: { ... };
  calendar_settings: {
    business_hours: BusinessHours;
    advance_booking_days: number;
  };
  ui_settings: {
    theme_color: string;
    button_style: 'rounded' | 'square';
    show_repeat_booking: boolean;
    show_side_nav: boolean;
  };
  validation_rules: { ... };
}
```

### Storeï¼ˆåº—èˆ—ï¼‰

```typescript
interface Store {
  id: string; // UUID
  name: string;
  owner_name: string;
  owner_email: string;
  phone?: string;
  address?: string;
  description?: string;
  website_url?: string;
  status: 'active' | 'inactive';
  created_at: string;
  updated_at: string;
}
```

## ğŸ”„ ä¸»è¦ãƒ•ãƒ­ãƒ¼

### 1. ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆãƒ•ãƒ­ãƒ¼

```
ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…
  â†“ åº—èˆ—ã‚’é¸æŠ â†’ ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆãƒœã‚¿ãƒ³
  â†“ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ â†’ åŸºæœ¬æƒ…å ±å…¥åŠ›
API: POST /api/stores/[storeId]/forms
  â†“
  â”œâ”€ Local: JSON ã«ä¿å­˜
  â””â”€ Staging/Prod: Supabase ã« INSERT
  â†“ åŒæ™‚ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
  â”œâ”€ StaticFormGenerator ã§ HTML ç”Ÿæˆ
  â””â”€ VercelBlobDeployer ã§ Blob ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  â†“ åˆæœŸçŠ¶æ…‹
  - status: 'inactive'
  - draft_status: 'none'
  - static_deploy: { url, deployed_at, status: 'deployed' }
```

### 2. ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ãƒ»ä¿å­˜ãƒ•ãƒ­ãƒ¼

```
åº—èˆ—ç®¡ç†è€…ãŒ /[storeId]/forms/[formId] ã§ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†
  â†“ è¤‡æ•°ã‚¿ãƒ–ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»å–¶æ¥­æ™‚é–“ãªã©ã‚’è¨­å®š
  â†“ ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ ã‚¯ãƒªãƒƒã‚¯
API: PUT /api/forms/[formId]
  â†“
  â”œâ”€ Local: JSON ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
  â””â”€ Staging/Prod: Supabase æ›´æ–°ï¼ˆRLS ç¢ºèªï¼‰
  â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  - status: 200
  - updated_at: ç¾åœ¨æ™‚åˆ»
  - ã‚¢ãƒ©ãƒ¼ãƒˆ: "ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸ"
```

### 3. é™çš„HTML ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```
åº—èˆ—ç®¡ç†è€…ãŒã€Œä¿å­˜ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚¯ãƒªãƒƒã‚¯
  â†“ 1. PUT /api/forms/{formId} ã§ä¿å­˜
  â†“ 2. POST /api/forms/{formId}/deploy ã§ãƒ‡ãƒ—ãƒ­ã‚¤
  â†“
StaticFormGenerator:
  â”œâ”€ config ã‹ã‚‰ HTML ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
  â”œâ”€ ã™ã¹ã¦ã®è¨­å®šã‚’ FORM_CONFIG ã«åŸ‹ã‚è¾¼ã¿
  â”œâ”€ ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ CSS ã§é©ç”¨
  â””â”€ LIFF SDK + JavaScriptã§äºˆç´„å‡¦ç†å®Ÿè£…
  â†“
VercelBlobDeployer:
  â”œâ”€ ç’°å¢ƒåˆ¥ path ã«æ±ºå®š
  â”‚  â”œâ”€ staging: staging/forms/{storeId}/{formId}.html
  â”‚  â””â”€ prod: prod/forms/{storeId}/{formId}.html
  â”œâ”€ Blob API ã§ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  â””â”€ URL ã‚’è¿”ã™
  â†“ DB æ›´æ–°
  - static_deploy: { url, deployed_at: now, status: 'deployed' }
  - last_published_at: now
  â†“ é¡§å®¢ãŒ LINE ã§ãƒ•ã‚©ãƒ¼ãƒ  URL ã‚¢ã‚¯ã‚»ã‚¹
  â†’ é™çš„ HTML ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆReact ãªã—ï¼‰
```

## ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### é˜²å¾¡çš„ãªå®Ÿè£…

1. **normalizeForm()** - æ—§å½¢å¼ãƒ»æ–°å½¢å¼ã®äº’æ›æ€§
   - Supabase JSONB ãŒ string ã§è¿”ã•ã‚Œã‚‹å ´åˆã‚’ãƒ‘ãƒ¼ã‚¹
   - ä¸è¶³ã—ã¦ã„ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è£œå®Œ

2. **StaticFormGenerator.generateHTML()** - undefined ãƒã‚§ãƒƒã‚¯
   - safeConfig ã«æ·±ã‚³ãƒ”ãƒ¼ã—ã¦ä¿®æ­£
   - å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åˆæœŸåŒ–ï¼ˆnull check ã‚’æ˜ç¤ºçš„ã«ï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ ?. ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ‹ãƒ³ã‚°

3. **API ã‚¨ãƒ©ãƒ¼** - æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   - 400: "å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™"
   - 404: "ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
   - 500: "å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **SETUP.md** - ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
- **API_SPECIFICATION.md** - API è©³ç´°ä»•æ§˜
- **DATABASE_MIGRATION.md** - DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ­´
- **WORKFLOW.md** - é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **SUPABASE_BEST_PRACTICES.md** - Supabase ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- **MCP_SETUP_GUIDE.md** - MCP ã‚µãƒ¼ãƒè¨­å®š

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´1æœˆ
