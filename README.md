# LINEäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  (Next.jsç‰ˆ)

LINE LIFFã‚’æ´»ç”¨ã—ãŸäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã€åº—èˆ—ç®¡ç†è€…ãŒãƒ•ã‚©ãƒ¼ãƒ ã‚’è¨­å®šãƒ»ç®¡ç†ã—ã€é¡§å®¢ãŒLINEä¸Šã§äºˆç´„ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

## ğŸŒŸ ä¸»ãªæ©Ÿèƒ½

### ğŸ”§ ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…æ©Ÿèƒ½
- **åº—èˆ—ç®¡ç†**: åº—èˆ—ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼ˆshadcn/uiåˆ·æ–°ï¼‰
  - ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®š
  - åº—èˆ—IDã¯6æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆ`[a-z0-9]{6}`ï¼‰ã§è‡ªå‹•ç”Ÿæˆ
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ**: 5ã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é¸æŠã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
  - åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰
  - ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ€§åˆ¥é¸æŠã‚ã‚Šï¼‰
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¯¾å¿œï¼‰
  - ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚ã‚Šï¼‰
  - ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå…¨æ©Ÿèƒ½æ­è¼‰ï¼‰
- **ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†**: å…¨åº—èˆ—ã®ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ³ç›£è¦–
- **äºˆç´„ç®¡ç†**: å…¨åº—èˆ—ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤ºãƒ»åˆ†æ
- **åº—èˆ—ç®¡ç†è€…ç®¡ç†**: å„åº—èˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤
- **åº—èˆ—å‰Šé™¤**: åº—èˆ—ã¨é–¢é€£ãƒ•ã‚©ãƒ¼ãƒ ã®ä¸€æ‹¬å‰Šé™¤ï¼ˆå±é™ºã‚¾ãƒ¼ãƒ³ï¼‰

### ğŸ“‹ åº—èˆ—ç®¡ç†è€…æ©Ÿèƒ½
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: äºˆç´„ä¸€è¦§ãƒ»åˆ†æãƒ»ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ã‚’çµ±åˆã—ãŸãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆshadcn/uiåˆ·æ–°ï¼‰
- **äºˆç´„ç®¡ç†**: è‡ªåº—èˆ—ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤ºãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **äºˆç´„åˆ†æ**: äºˆç´„çŠ¶æ³ã®çµ±è¨ˆãƒ»ã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼ˆæ—¥åˆ¥ãƒ»æ™‚é–“å¸¯åˆ¥ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¥ï¼‰
- **ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹**: `{subdomain}.{base-domain}` ã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ãƒ•ã‚©ãƒ¼ãƒ åŸºæœ¬æƒ…å ±è¨­å®š**: åº—èˆ—åã€ãƒ•ã‚©ãƒ¼ãƒ åã€LIFF IDã€ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã®è¨­å®šï¼ˆåº—èˆ—ç®¡ç†è€…ã¯LIFF ID/GAS Endpointç·¨é›†ä¸å¯ï¼‰
- **ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚«ãƒ†ã‚´ãƒªç®¡ç†**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ã‚«ãƒ†ã‚´ãƒªã®ä½œæˆãƒ»ç®¡ç†
- **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç”»åƒã‚’æ·»ä»˜ï¼ˆSupabase Storageçµ±åˆï¼‰
- **æ€§åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ€§åˆ¥ã«ã‚ˆã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºåˆ¶å¾¡
- **å–¶æ¥­æ™‚é–“è¨­å®š**: æ›œæ—¥åˆ¥å–¶æ¥­æ™‚é–“ãƒ»å®šä¼‘æ—¥ã®è¨­å®š
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**: å¤‰æ›´å†…å®¹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèª
- **ãƒ•ã‚©ãƒ¼ãƒ å…¬é–‹ç®¡ç†**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
- **ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†**: ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- **èªè¨¼**: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢çµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹

### ğŸ‘¥ é¡§å®¢å‘ã‘æ©Ÿèƒ½
- **ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–**: LINEå†…ã§ã®ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **æ€§åˆ¥é¸æŠ**: è¨­å®šã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ**: ç”»åƒä»˜ããƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸æŠ
- **ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼**: è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠ
- **äºˆç´„æ—¥æ™‚é¸æŠ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥æ™‚ã‚’é¸æŠï¼ˆGoogle Calendaré€£æºå¯¾å¿œï¼‰
- **é¡§å®¢æƒ…å ±å…¥åŠ›**: åå‰ã€é›»è©±ç•ªå·ã€è¦æœ›ç­‰ã®å…¥åŠ›
- **Google Apps Scripté€£æº**: äºˆç´„ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•é€ä¿¡
- **Google Calendaré€£æº**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç©ºãçŠ¶æ³ã‚’ç¢ºèªã—ã¦äºˆç´„å¯èƒ½æ—¥æ™‚ã‚’è¡¨ç¤º

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Framework**: Next.js 16.0.10 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS v4
- **UI Components**: shadcn/ui (Radix UIãƒ™ãƒ¼ã‚¹)
  - Avatar, Badge, Button, Card, Dialog, DropdownMenu, Input, Label, Select, Sheet, Table, Tabs, Toast, Toaster
  - `lucide-react` ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Database**: Supabase (Staging/Production), JSON ãƒ•ã‚¡ã‚¤ãƒ« (Localé–‹ç™º)
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storageï¼ˆç”»åƒãƒ»ãƒ•ã‚©ãƒ¼ãƒ HTMLï¼‰
- **Static Deployment**: Supabase Storageï¼ˆé¡§å®¢å‘ã‘ãƒ•ã‚©ãƒ¼ãƒ ï¼‰
- **Backend Integration**: Google Apps Script
- **Package Manager**: pnpm

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                     # API Routes
â”‚   â”‚   â”œâ”€â”€ forms/[formId]/     # ãƒ•ã‚©ãƒ¼ãƒ å€‹åˆ¥API
â”‚   â”‚   â”œâ”€â”€ stores/             # åº—èˆ—é–¢é€£API
â”‚   â”‚   â”œâ”€â”€ surveys/            # ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ API
â”‚   â”‚   â”œâ”€â”€ reservations/       # äºˆç´„ç®¡ç†APIï¼ˆå…¨åº—èˆ—ï¼‰
â”‚   â”‚   â”œâ”€â”€ upload/             # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰API
â”‚   â”‚   â””â”€â”€ public-form/        # å…¬é–‹ãƒ•ã‚©ãƒ¼ãƒ ãƒ—ãƒ­ã‚­ã‚·API
â”‚   â”œâ”€â”€ admin/                  # ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ç”»é¢
â”‚   â”‚   â”œâ”€â”€ [storeId]/          # åº—èˆ—è©³ç´°ç®¡ç†
â”‚   â”‚   â””â”€â”€ reservations/       # å…¨äºˆç´„ä¸€è¦§
â”‚   â”œâ”€â”€ [storeId]/              # åº—èˆ—ç®¡ç†è€…ç”»é¢
â”‚   â”‚   â”œâ”€â”€ admin/              # åº—èˆ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ forms/[formId]/     # ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ç”»é¢
â”‚   â”‚   â””â”€â”€ reservations/       # åº—èˆ—åˆ¥äºˆç´„ä¸€è¦§
â”‚   â”œâ”€â”€ form/[formId]/          # é¡§å®¢å‘ã‘ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â””â”€â”€ login/                  # åº—èˆ—ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
â”œâ”€â”€ components/                  # å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ Calendar/               # ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢é€£
â”‚   â”œâ”€â”€ FormEditor/             # ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ FormEditModal.tsx  # ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆäºˆç´„ãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå…±é€šï¼‰
â”‚   â”‚   â”œâ”€â”€ Reservation/        # äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ Survey/             # ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ FormRenderer/           # ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ Layout/                 # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ StoreAdminLayout.tsx    # åº—èˆ—ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ StoreAdminManager.tsx  # åº—èˆ—ç®¡ç†è€…ç®¡ç†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ReservationAnalytics.tsx # äºˆç´„åˆ†æã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ ui/                     # shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”œâ”€â”€ avatar.tsx
â”‚       â”œâ”€â”€ badge.tsx
â”‚       â”œâ”€â”€ button.tsx
â”‚       â”œâ”€â”€ card.tsx
â”‚       â”œâ”€â”€ dialog.tsx
â”‚       â”œâ”€â”€ dropdown-menu.tsx
â”‚       â”œâ”€â”€ input.tsx
â”‚       â”œâ”€â”€ label.tsx
â”‚       â”œâ”€â”€ select.tsx
â”‚       â”œâ”€â”€ sheet.tsx
â”‚       â”œâ”€â”€ table.tsx
â”‚       â”œâ”€â”€ tabs.tsx
â”‚       â”œâ”€â”€ toast.tsx
â”‚       â””â”€â”€ toaster.tsx
â”œâ”€â”€ lib/                        # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ memory-storage.ts       # ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ static-generator-reservation.ts  # äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ é™çš„HTMLç”Ÿæˆ
â”‚   â”œâ”€â”€ static-generator-survey.ts       # ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ é™çš„HTMLç”Ÿæˆ
â”‚   â””â”€â”€ supabase-storage-deployer.ts     # Supabase Storageç®¡ç†
â”œâ”€â”€ middleware.ts               # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”œâ”€â”€ types/                      # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ form.ts                 # ãƒ•ã‚©ãƒ¼ãƒ ãƒ»äºˆç´„å‹
â”‚   â””â”€â”€ store.ts                # åº—èˆ—å‹
â””â”€â”€ utils/                      # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
data/                           # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« (é–‹ç™ºç”¨)
â”œâ”€â”€ stores.json                 # åº—èˆ—ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ forms_st*.json              # åº—èˆ—åˆ¥ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
â””â”€â”€ reservations.json           # äºˆç´„ãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨åº—èˆ—å…±é€šï¼‰
```

## ğŸš€ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

> **ğŸ“– è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰**: [`SETUP.md`](SETUP.md) ã‚’å‚ç…§
> 
> **ğŸ“‹ æ—¥å¸¸çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼**: [`WORKFLOW.md`](WORKFLOW.md) ã‚’å‚ç…§ â­ **é–‹ç™ºè€…å¿…èª­**

### å‰ææ¡ä»¶
- Node.js 20ä»¥ä¸Š
- **pnpm 9ä»¥ä¸Š** (npm/yarn ä½¿ç”¨ç¦æ­¢)

#### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æ–¹ï¼ˆNode.jsãŒã¾ã ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰

**Node.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
1. [Node.jså…¬å¼ã‚µã‚¤ãƒˆ](https://nodejs.org/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. LTSç‰ˆï¼ˆæ¨å¥¨ç‰ˆï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ç¢ºèªï¼š
   ```bash
   node --version  # v18.0.0ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   npm --version   # npmã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™
   ```

**Gitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…è¦ãªå ´åˆï¼‰:**
- [Gitå…¬å¼ã‚µã‚¤ãƒˆ](https://git-scm.com/)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- ã¾ãŸã¯ã€macOSã®å ´åˆï¼š`xcode-select --install`
- Windowsã®å ´åˆï¼š[Git for Windows](https://gitforwindows.org/)

**æ¨å¥¨ã‚¨ãƒ‡ã‚£ã‚¿:**
- [Visual Studio Code](https://code.visualstudio.com/) + ä»¥ä¸‹ã®æ‹¡å¼µæ©Ÿèƒ½ï¼š
  - TypeScript and JavaScript Language Features
  - ES7+ React/Redux/React-Native snippets
  - Tailwind CSS IntelliSense
  - Prettier - Code formatter

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼‰

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/wakuwakusystemsharing/form-management.git
cd form-management

# 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (pnpm å¿…é ˆ)
pnpm install

# 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
cp .env.local.example .env.local
# NEXT_PUBLIC_APP_ENV=local ã®ã¾ã¾ (JSON ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰)

# 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
pnpm dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹

### é–‹ç™ºãƒ•ãƒ­ãƒ¼ï¼ˆå®Ÿéš›ã®ä½œæ¥­ï¼‰

```bash
# 1. æ–°æ©Ÿèƒ½ã®é–‹ç™ºé–‹å§‹ï¼ˆdevãƒ–ãƒ©ãƒ³ãƒã§é–‹ç™ºï¼‰
git checkout dev
git pull origin dev
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½è¿½åŠ "
git push origin dev  # ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥å¯èƒ½

# 2. ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™º
pnpm dev  # ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™º

# 3. Staging ã§ç¢ºèª
# GitHub ã§ Pull Request ã‚’ä½œæˆ: dev â†’ staging
# ãƒ¬ãƒ“ãƒ¥ãƒ¼ & ãƒãƒ¼ã‚¸å¾Œã€Stagingç’°å¢ƒã§å‹•ä½œç¢ºèª

# 4. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
# GitHub ã§ Pull Request ã‚’ä½œæˆ: staging â†’ main
# ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆï¼ˆ1åä»¥ä¸Šã€æ¨å¥¨: 2åï¼‰& ãƒãƒ¼ã‚¸
```

**ğŸ”’ ãƒ–ãƒ©ãƒ³ãƒä¿è­·ãƒ«ãƒ¼ãƒ«**:
- `main` (Production): ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ç¦æ­¢ã€`staging` ã‹ã‚‰ã®PRã®ã¿
- `staging`: ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ç¦æ­¢ã€`dev` ã¾ãŸã¯ `feature/*` ã‹ã‚‰ã®PRã®ã¿
- `dev`: ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥å¯èƒ½ï¼ˆé–‹ç™ºç”¨ï¼‰

è©³ç´°ã¯ [`docs/WORKFLOW.md`](docs/WORKFLOW.md) ã¨ [`docs/BRANCH_PROTECTION.md`](docs/BRANCH_PROTECTION.md) ã‚’å‚ç…§

### åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

- `pnpm run dev` - é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- `pnpm run build` - ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
- `pnpm run start` - ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- `pnpm run lint` - ESLintã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰æ¤œæŸ»
- `pnpm run type-check` - TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ç”»é¢
1. `/admin` ã§ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
2. åº—èˆ—ç®¡ç†ã§æ–°è¦åº—èˆ—ã‚’ä½œæˆ
3. `/admin/{storeId}` ã§åº—èˆ—è©³ç´°ç”»é¢ã‚’é–‹ã
4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆï¼š
   - **åŸºæœ¬**: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
   - **ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰**: æ€§åˆ¥é¸æŠæ©Ÿèƒ½ä»˜ã
   - **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ **: ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¯¾å¿œ
   - **ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»æ¥åº—å›æ•°é¸æŠ
   - **ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ**: å…¨æ©Ÿèƒ½ï¼ˆã‚¯ãƒ¼ãƒãƒ³ãƒ»ãƒªãƒ”ãƒ¼ãƒˆäºˆç´„ï¼‰
5. ã€Œå…¨äºˆç´„ä¸€è¦§ã€ãƒœã‚¿ãƒ³ã§å…¨åº—èˆ—ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
6. åº—èˆ—å‰Šé™¤ï¼ˆå±é™ºã‚¾ãƒ¼ãƒ³ï¼‰ã§åº—èˆ—ã¨é–¢é€£ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¸€æ‹¬å‰Šé™¤

### åº—èˆ—ç®¡ç†è€…ç”»é¢
1. `/login` ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆé–‹ç™ºä¸­ã¯èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
2. `/{storeId}/admin` ã§åº—èˆ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ã€Œäºˆç´„ä¸€è¦§ã€ãƒœã‚¿ãƒ³ã§è‡ªåº—èˆ—ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
4. ãƒ•ã‚©ãƒ¼ãƒ ä¸€è¦§ã§ç·¨é›†ã—ãŸã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠ
5. å„ã‚¿ãƒ–ã§è¨­å®šã‚’è¡Œã†ï¼š
   - **åŸºæœ¬æƒ…å ±**: åº—èˆ—æƒ…å ±ã€ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼è¨­å®š
   - **ãƒ¡ãƒ‹ãƒ¥ãƒ¼**: ã‚«ãƒ†ã‚´ãƒªãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ç®¡ç†ï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œï¼‰
   - **å–¶æ¥­æ™‚é–“**: å–¶æ¥­æ™‚é–“ã€ä¼‘æ¥­æ—¥è¨­å®š
   - **ã‚ªãƒ—ã‚·ãƒ§ãƒ³**: æ€§åˆ¥é¸æŠã€ã‚¯ãƒ¼ãƒãƒ³ç­‰ã®è¨­å®š
6. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªå¾Œã€å…¬é–‹
7. ã€Œå†ãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒœã‚¿ãƒ³ã§Supabase Storageã«é™çš„HTMLã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

### é¡§å®¢å‘ã‘ãƒ•ã‚©ãƒ¼ãƒ 
1. `/form/{formId}` ã§ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. è¨­å®šã«å¿œã˜ã¦ä»¥ä¸‹ã‚’é¸æŠï¼š
   - æ€§åˆ¥é¸æŠï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
   - æ¥åº—å›æ•°é¸æŠï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
   - ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
3. ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠï¼ˆç”»åƒç¢ºèªå¯èƒ½ï¼‰
4. ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠ
5. äºˆç´„æ—¥æ™‚é¸æŠ
6. é¡§å®¢æƒ…å ±å…¥åŠ›
7. äºˆç´„ç¢ºå®šï¼ˆGoogle Apps Scriptã«é€ä¿¡ï¼‰

## ğŸ”§ è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½
ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆæ™‚ã«5ã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é¸æŠå¯èƒ½ï¼š

| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | æ©Ÿèƒ½ |
|------------|------|
| åŸºæœ¬ | ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ |
| ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ | + æ€§åˆ¥é¸æŠ |
| ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  | + ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ |
| ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ | + ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»æ¥åº—å›æ•° |
| ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ | + ã‚¯ãƒ¼ãƒãƒ³ãƒ»ãƒªãƒ”ãƒ¼ãƒˆäºˆç´„ |

### ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å¯¾å¿œå½¢å¼: PNG, JPEG, GIF, WebP (æœ€å¤§5MB)
- Supabase StorageçµŒç”±ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒ‘ã‚¹: `menu_images/{storeId}/{menuId}.{ext}`
- é¡§å®¢ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º

### ãƒ•ã‚©ãƒ¼ãƒ æ§‹é€ ã®äº’æ›æ€§
- æ–°å½¢å¼ï¼ˆç°¡æ˜“æ§‹é€ ï¼‰ã¨æ—§å½¢å¼ï¼ˆconfigæ§‹é€ ï¼‰ã®ä¸¡æ–¹ã«å¯¾å¿œ
- APIãƒ¬ãƒ™ãƒ«ã§è‡ªå‹•æ­£è¦åŒ–

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…** â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ â†’ ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
2. **åº—èˆ—ç®¡ç†è€…** â†’ ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›† â†’ è¨­å®šä¿å­˜
3. **é¡§å®¢** â†’ ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ› â†’ GASé€ä¿¡ â†’ äºˆç´„å®Œäº†

### APIè¨­è¨ˆ
- `/api/stores` - åº—èˆ—ç®¡ç†ï¼ˆCRUDï¼‰
- `/api/stores/{storeId}` - å€‹åˆ¥åº—èˆ—æ“ä½œ
- `/api/stores/{storeId}/forms` - åº—èˆ—åˆ¥ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
- `/api/stores/{storeId}/surveys` - åº—èˆ—åˆ¥ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
- `/api/stores/{storeId}/reservations` - åº—èˆ—åˆ¥äºˆç´„ä¸€è¦§
- `/api/stores/{storeId}/reservations/analytics` - äºˆç´„åˆ†æãƒ‡ãƒ¼ã‚¿å–å¾—
- `/api/stores/{storeId}/admins` - åº—èˆ—ç®¡ç†è€…ç®¡ç†ï¼ˆä¸€è¦§ãƒ»è¿½åŠ ï¼‰
- `/api/stores/{storeId}/admins/{userId}` - åº—èˆ—ç®¡ç†è€…å‰Šé™¤
- `/api/forms/{formId}` - ãƒ•ã‚©ãƒ¼ãƒ å€‹åˆ¥æ“ä½œ
- `/api/forms/{formId}/deploy` - Supabase Storageãƒ‡ãƒ—ãƒ­ã‚¤
- `/api/surveys/{id}` - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ å€‹åˆ¥æ“ä½œ
- `/api/surveys/{id}/deploy` - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ—ãƒ­ã‚¤
- `/api/reservations` - å…¨äºˆç´„ç®¡ç†ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…ç”¨ï¼‰
- `/api/upload/menu-image` - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `/api/public-form/[...path]` - å…¬é–‹ãƒ•ã‚©ãƒ¼ãƒ ãƒ—ãƒ­ã‚­ã‚·ï¼ˆSupabase Storageã‹ã‚‰é…ä¿¡ï¼‰
- `/api/auth/set-cookie` - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã«è¨­å®š
- `/api/auth/verify` - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- RESTfulè¨­è¨ˆã§CRUDæ“ä½œå¯¾å¿œ

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
```bash
pnpm run build
pnpm run start
```

### ç’°å¢ƒå¤‰æ•°
`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®è¨­å®šï¼š
```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒ
NEXT_PUBLIC_APP_ENV=local  # local | staging | production

# Supabaseï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»èªè¨¼ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Productionç’°å¢ƒã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆProductionç’°å¢ƒã®ã¿ï¼‰
NEXT_PUBLIC_PRODUCTION_URL=https://nas-rsv.com
```

**ç’°å¢ƒã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ**:
- `NEXT_PUBLIC_APP_ENV=local`: JSON ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼‰
- `NEXT_PUBLIC_APP_ENV=staging/production`: Supabaseï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- ç’°å¢ƒå¤‰æ•°æœªè¨­å®šæ™‚: URLã‹ã‚‰è‡ªå‹•åˆ¤å®šï¼ˆlocalhost â†’ local, vercel.app â†’ staging/productionï¼‰

### Supabase Storageã®è¨­å®š
1. Supabase Dashboard > Storage > Create bucket
2. ãƒã‚±ãƒƒãƒˆå: `forms`
3. Public bucket: æœ‰åŠ¹ï¼ˆåŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
4. è©³ç´°: [`SUPABASE_STORAGE_SETUP.md`](docs/SUPABASE_STORAGE_SETUP.md) ã‚’å‚ç…§

### ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆå€™è£œ
- **Vercel**: Next.jsã«æœ€é©åŒ–ï¼ˆæ¨å¥¨ï¼‰
- **Netlify**: é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°
- **AWS Amplify**: ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯å¯¾å¿œ

## ğŸ¤ é–‹ç™ºã‚¬ã‚¤ãƒ‰

### æ–°æ©Ÿèƒ½ã®è¿½åŠ 
1. `src/types/form.ts` ã§å‹å®šç¾©ã‚’è¿½åŠ 
2. APIãƒ«ãƒ¼ãƒˆã‚’ `src/app/api/` ã«å®Ÿè£…
3. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã«çµ±åˆ

### ã‚³ãƒ¼ãƒ‰è¦ç´„
- TypeScriptã®å³æ ¼ãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨
- ESLint + Prettier ã§ã‚³ãƒ¼ãƒ‰å“è³ªç¶­æŒ
- Next.js App Routerã®è¦ç´„ã«å¾“ã†
- Tailwind CSSã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

### ãƒ‡ãƒãƒƒã‚°
- ãƒ•ã‚©ãƒ¼ãƒ æ§‹é€ ã®äº’æ›æ€§å•é¡Œ â†’ APIæ­£è¦åŒ–ã‚’ç¢ºèª
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å•é¡Œ â†’ Supabase Storageè¨­å®šã‚’ç¢ºèª
- GASé€£æºå•é¡Œ â†’ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLè¨­å®šã‚’ç¢ºèª
- èªè¨¼ã‚¨ãƒ©ãƒ¼ â†’ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨Supabaseè¨­å®šã‚’ç¢ºèª

## ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å½¹å‰²
- **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…**: å…¨åº—èˆ—ãƒ»å…¨äºˆç´„ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- **åº—èˆ—ç®¡ç†è€…**: è‡ªåº—èˆ—ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆï¼‰
- **é¡§å®¢**: LINE LIFFçµŒç”±ã§äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹

### å®Ÿè£…çŠ¶æ³
- âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ä½œæˆï¼ˆ`/login`ï¼‰
- âœ… èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆ`src/middleware.ts`ï¼‰- UI ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®ã¿
- âœ… API èªè¨¼ - å„ API ãƒ«ãƒ¼ãƒˆå†…ã§ç‹¬ç«‹å‡¦ç†
- âœ… Supabase Authçµ±åˆï¼ˆmiddleware.ts ã§ getUser() ãƒã‚§ãƒƒã‚¯ï¼‰
- âœ… Admin Clientï¼ˆRLSãƒã‚¤ãƒ‘ã‚¹ï¼‰ã§ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…æ¨©é™å®Ÿè£…
- âœ… äºˆç´„ç®¡ç†APIï¼ˆåº—èˆ—åˆ¥ãƒ»å…¨ä½“ï¼‰
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¯èªè¨¼ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé–‹ç™ºåŠ¹ç‡åŒ–ï¼‰
- âœ… Row Level Securityé©ç”¨
- âœ… credentials: 'include' ã§ Cookie è‡ªå‹•é€ä¿¡ï¼ˆæœ¬ç•ªç’°å¢ƒå¯¾å¿œï¼‰
- âœ… PR ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ã‚¸ - GitHub branch protection rules ã§ main ä¿è­·

## ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆSupabaseï¼‰

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

#### `stores` ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (text) - åº—èˆ—IDï¼ˆ6æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ— `[a-z0-9]{6}` ã¾ãŸã¯ UUIDå½¢å¼ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼‰ï¼‰
- `name` (text) - åº—èˆ—å
- `owner_name`, `owner_email` (text, NOT NULL) - ã‚ªãƒ¼ãƒŠãƒ¼æƒ…å ±
- `phone`, `address`, `website_url`, `description` (text, nullable) - åº—èˆ—è©³ç´°
- `status` (text, default 'active') - 'active' | 'inactive'
- `created_at`, `updated_at` (timestamptz)

#### `forms` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ï¼‰
- `id` (uuid) - ãƒ•ã‚©ãƒ¼ãƒ IDï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `store_id` (uuid, nullable) - åº—èˆ—IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
- `name` (text, nullable) - ãƒ•ã‚©ãƒ¼ãƒ åï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
- `form_name` (text, nullable) - ãƒ•ã‚©ãƒ¼ãƒ åï¼ˆæ–°å½¢å¼ï¼‰
- `status` (text, default 'inactive') - 'active' | 'inactive'
- `draft_status` (text, default 'none') - 'none' | 'draft' | 'ready_to_publish'
- `config` (jsonb) - ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š
- `static_deploy` (jsonb, nullable) - ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±
- `last_published_at` (timestamptz, nullable)
- `line_settings` (jsonb, nullable) - LINEè¨­å®šï¼ˆLIFF IDç­‰ï¼‰
- `gas_endpoint` (text, nullable) - Google Apps Script URL
- `ui_settings` (jsonb, nullable) - UIè¨­å®š
- `created_at`, `updated_at` (timestamptz)

#### `survey_forms` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰
- `id` (text) - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ IDï¼ˆ12æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼‰
- `store_id` (text, NOT NULL) - åº—èˆ—IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ã€6æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã¾ãŸã¯UUIDï¼‰
- `name` (text, NOT NULL) - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ å
- `config` (jsonb) - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆè¨­å®šï¼ˆè³ªå•ãƒ»UIè¨­å®šã‚’å«ã‚€ï¼‰
- `status` (text, default 'draft') - 'active' | 'inactive' | 'paused' | 'draft'
- `draft_status` (text, default 'none') - 'none' | 'draft' | 'ready_to_publish'
- `static_deploy` (jsonb, nullable) - ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±ï¼ˆdeploy_url, storage_url, deployed_atç­‰ï¼‰
- `created_at`, `updated_at` (timestamptz)
- `last_published_at` (timestamptz, nullable) - æœ€çµ‚å…¬é–‹æ—¥æ™‚

#### `reservations` ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (uuid) - äºˆç´„IDï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `form_id`, `store_id` (uuid, nullable) - é–¢é€£ID
- `customer_name` (text) - é¡§å®¢å
- `customer_email` (text, nullable) - é¡§å®¢ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `customer_phone` (text, nullable) - é¡§å®¢é›»è©±ç•ªå·
- `reservation_date` (date) - äºˆç´„æ—¥
- `reservation_time` (time) - äºˆç´„æ™‚é–“
- `menu_items` (jsonb) - é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼
- `options` (jsonb) - é¸æŠã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `notes` (text, nullable) - å‚™è€ƒ
- `created_at`, `updated_at` (timestamptz)

#### `store_admins` ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (uuid) - ç®¡ç†è€…IDï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `user_id` (uuid, nullable) - ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
- `store_id` (uuid, nullable) - åº—èˆ—IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
- `created_at` (timestamptz)

### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è€…**: Admin Clientï¼ˆRLSãƒã‚¤ãƒ‘ã‚¹ï¼‰ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
- **åº—èˆ—ç®¡ç†è€…**: RLSã§ `store_id` ã«ã‚ˆã‚‹åˆ¶é™ï¼ˆå®Ÿè£…äºˆå®šï¼‰
- **é¡§å®¢**: äºˆç´„ä½œæˆã®ã¿ï¼ˆå…¬é–‹APIï¼‰

### IDå½¢å¼
- **ã‚¹ãƒˆã‚¢ID**:
  - **æ–°è¦ä½œæˆ**: 6æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆ`[a-z0-9]{6}`ï¼‰
  - **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿**: UUIDå½¢å¼ã¾ãŸã¯`st{timestamp}`å½¢å¼ï¼ˆå¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼‰
  - **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: ä¸¡å½¢å¼ã«å¯¾å¿œï¼ˆ`/[a-z0-9]{6}/` ã¾ãŸã¯ `/st\d{4}/`ï¼‰
- **ãƒ•ã‚©ãƒ¼ãƒ ID**: 12æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ å…±é€šï¼‰
- **Localé–‹ç™º**: `st{timestamp}` å½¢å¼ï¼ˆJSONäº’æ›æ€§ç¶­æŒï¼‰

## ğŸŒ ç’°å¢ƒåˆ¥è¨­å®š

### ç’°å¢ƒã®ç¨®é¡

| ç’°å¢ƒ | URL | ãƒ–ãƒ©ãƒ³ãƒ | ç”¨é€” | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Storage |
|------|-----|---------|------|-------------|---------|
| **Productionï¼ˆæœ¬ç•ªï¼‰** | https://nas-rsv.com (ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³) | `main` | å•†ç”¨ãƒ»å®Ÿé‹ç”¨ | Supabase Production (æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€Pro ãƒ—ãƒ©ãƒ³) | Supabase Storage Production |
| **Stagingï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰** | https://form-management-staging.vercel.app | `staging` | ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ | Supabase Staging (æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ) | Supabase Storage Staging |
| **Localï¼ˆé–‹ç™ºï¼‰** | http://localhost:3000 | `staging` | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º | JSON ãƒ•ã‚¡ã‚¤ãƒ« | Mock (ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«) |

### ç’°å¢ƒåˆ¥ã®ä¸»ãªé•ã„

#### ğŸŸ¢ Productionï¼ˆhttps://nas-rsv.comï¼‰
- **ç”¨é€”**: å•†ç”¨ãƒ»å®Ÿé‹ç”¨ç’°å¢ƒ
- **URL**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ `https://nas-rsv.com` ã‚’ä½¿ç”¨
- **èªè¨¼**: Supabase Auth æœ¬ç•ªç’°å¢ƒ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase Production ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ**æ–°è¦ä½œæˆã€Pro ãƒ—ãƒ©ãƒ³æ¨å¥¨**ï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage Production (`prod/forms/{storeId}/{formId}/config/current.html`)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: `main` ãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸æ™‚ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **RLS**: Row Level Security æœ‰åŠ¹
- **ç‰¹å¾´**: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã€**staging ã¨ã¯å®Œå…¨ã«åˆ†é›¢**
- **ãƒ•ã‚©ãƒ¼ãƒ URL**: `https://nas-rsv.com/api/public-form/prod/forms/{storeId}/{formId}/config/current.html`

#### ğŸŸ¡ Stagingï¼ˆform-management-staging.vercel.appï¼‰
- **ç”¨é€”**: ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ãƒ»ãƒ‡ãƒ¢
- **èªè¨¼**: Supabase Auth ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒï¼ˆãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase Staging ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ**æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¶™ç¶šä½¿ç”¨**ï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage Staging (`staging/forms/{storeId}/{formId}/config/current.html`)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: `staging` ãƒ–ãƒ©ãƒ³ãƒã¸ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **RLS**: Row Level Security æœ‰åŠ¹
- **ç‰¹å¾´**: é–‹ç™ºãƒãƒ¼ãƒ å‘ã‘ã€æ–°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã€PR ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã€**production ã¨ã¯å®Œå…¨ã«åˆ†é›¢**

#### ğŸŸ  Developmentï¼ˆdevãƒ–ãƒ©ãƒ³ãƒ - Vercel Previewï¼‰
- **ç”¨é€”**: é–‹ç™ºç’°å¢ƒãƒ»æ©Ÿèƒ½é–‹ç™ºãƒ»å®Ÿé¨“çš„æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- **èªè¨¼**: Supabase Auth é–‹ç™ºç’°å¢ƒ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase Staging ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® **devãƒ–ãƒ©ãƒ³ãƒ**ï¼ˆãƒ–ãƒ©ãƒ³ãƒæ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage Development (`dev/forms/{storeId}/{formId}/config/current.html`)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: `dev` ãƒ–ãƒ©ãƒ³ãƒã¸ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆVercel Previewç’°å¢ƒï¼‰
- **RLS**: Row Level Security æœ‰åŠ¹
- **ç‰¹å¾´**: é–‹ç™ºä¸­ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã€production/stagingã¨ã¯å®Œå…¨ã«åˆ†é›¢ã€**Supabaseãƒ–ãƒ©ãƒ³ãƒæ©Ÿèƒ½ã‚’ä½¿ç”¨**ã€**æœ¬ç•ªç’°å¢ƒã¸ã®å½±éŸ¿ã‚’å›é¿**

#### ğŸ”µ Localï¼ˆlocalhost:3000ï¼‰
- **ç”¨é€”**: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°
- **èªè¨¼**: ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå…¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: `data/` ãƒ•ã‚©ãƒ«ãƒ€ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Mockï¼ˆ`public/static-forms/` ã«å‡ºåŠ›ï¼‰
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: ãªã—ï¼ˆ`pnpm dev` ã§å®Ÿè¡Œï¼‰
- **RLS**: é©ç”¨ãªã—
- **ç‰¹å¾´**: èªè¨¼ä¸è¦ã€é«˜é€Ÿé–‹ç™ºã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œå¯èƒ½

### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

```bash
# Local é–‹ç™ºç’°å¢ƒï¼ˆ.env.localï¼‰
NEXT_PUBLIC_APP_ENV=local
# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚‚è¨­å®š:
# NEXT_PUBLIC_SUPABASE_URL=<Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URL>
# NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon-key>
# SUPABASE_SERVICE_ROLE_KEY=<service-role-key>
# 
# å–å¾—æ–¹æ³•: https://supabase.com/dashboard/project/[project-ref]/settings/api-keys/legacy
# ä¾‹: https://supabase.com/dashboard/project/ohplaysshllkinaiqksb/settings/api-keys/legacy

# Staging ç’°å¢ƒï¼ˆVercel Environment Variables - Previewã€stagingãƒ–ãƒ©ãƒ³ãƒç”¨ï¼‰
NEXT_PUBLIC_APP_ENV=staging
NEXT_PUBLIC_SUPABASE_URL=<æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URL>  # Staging ç”¨ Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
NEXT_PUBLIC_SUPABASE_ANON_KEY=<æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®anon-key>
SUPABASE_SERVICE_ROLE_KEY=<æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®service-role-key>
# å–å¾—æ–¹æ³•: https://supabase.com/dashboard/project/[project-ref]/settings/api-keys/legacy

# Development ç’°å¢ƒï¼ˆVercel Environment Variables - Previewã€devãƒ–ãƒ©ãƒ³ãƒç”¨ï¼‰
# âš ï¸ æ³¨æ„: Supabaseãƒ–ãƒ©ãƒ³ãƒæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€devãƒ–ãƒ©ãƒ³ãƒã®URLã¨ã‚­ãƒ¼ã‚’ä½¿ç”¨
NEXT_PUBLIC_APP_ENV=staging  # ã¾ãŸã¯ developmentï¼ˆç’°å¢ƒåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã«å¿œã˜ã¦ï¼‰
NEXT_PUBLIC_SUPABASE_URL=<devãƒ–ãƒ©ãƒ³ãƒã®URL>  # Supabase Stagingãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®devãƒ–ãƒ©ãƒ³ãƒ
NEXT_PUBLIC_SUPABASE_ANON_KEY=<devãƒ–ãƒ©ãƒ³ãƒã®anon-key>
SUPABASE_SERVICE_ROLE_KEY=<devãƒ–ãƒ©ãƒ³ãƒã®service-role-key>
# å–å¾—æ–¹æ³•: Supabase Dashboard â†’ Stagingãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ Branches â†’ dev â†’ Settings â†’ API Keys
# ã¾ãŸã¯: https://supabase.com/dashboard/project/[staging-project-ref]/branches/dev/settings/api-keys/legacy

# Production ç’°å¢ƒï¼ˆVercel Environment Variables - Productionï¼‰
NEXT_PUBLIC_APP_ENV=production
NEXT_PUBLIC_SUPABASE_URL=<æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URL>  # Production ç”¨ Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ–°è¦ä½œæˆï¼‰
NEXT_PUBLIC_SUPABASE_ANON_KEY=<æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®anon-key>
SUPABASE_SERVICE_ROLE_KEY=<æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®service-role-key>
# å–å¾—æ–¹æ³•: https://supabase.com/dashboard/project/[project-ref]/settings/api-keys/legacy
```

